{
  "hash": "c54efb2f53bb2a085e6228fb0d303aad",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"An artistic map of my biking meandering using rStrava and open street maps\"\nsubtitle: \"Here‚Äôs to past watts, nice maps, and many new roads ahead\"\nauthor: \"Aur√©lien Sallin\"\ndate: \"2025-12-31\"\nimage: cache/my_rides_yearly.png\ndescription: \"In 2025, I spent 322h biking around the countryside. Here is an artistic, data visualization way, to represent these hours of discovery and sweating effort.\"\nkeywords: [\"Strava\", \"Data viz\", \"Data science\"]\ntoc: false\nformat:\n  html:\n    # css: \"style_quarto.css\"\n    code-fold: true\nknitr:\n  opts_chunk:\n    dev.args:\n      bg: transparent\n---\n\n\n\n## Representing my biking in an artistic way\nIn 2025, **I spent 322h biking around the countryside**. In comparison to the time I spent working, teaching, or handling everyday family tasks, this is not a lot. But time spent biking (and also running) has a special quality to it. It is time outside, alone or with friends, an immediate and physical experience of speed, distance, and calm. This experience contrasts with my screen-based work, and has become a central element of balance and peace of mind in my life.\n\nI ride to clear my head, to stay fit, to find new roads. And I record those rides on Strava. As a data visualization afficionado,  I like to **visualize my rides on maps**. Seeing on maps how biking allowed me to discover new places and new roads over time gives me a deep feeling of freedom and excitement for future adventures. \n\nIn this blog, **I created an artistic map** that traces my bike rides and my runs since 2021. It shows with lines the meandering of my sport. The map displays the evolution over time and conveys this sense of unframed freedom and unlimited possibilities. \n\n::: {.banner}\n![](cache/my_rides_yearly.png){.banner-image}\n:::\n\nFor each year, my biking activities are drawn on the map. I chose a facetted map with the cumulated activities over year to display the evolution. Letting activities grow outside the frame gives a sense of boundless exploration. The focus of the design is on activities, not on the map itself: for this reason, the roads and geographical elements are minimal to highlight the rides. If you know Eastern Switzerland, you'll recognize Lake Constance, and Lake Z√ºrich. For bikers here, you'll notice the Gold Tour of the Alpenbrevet appearing in 2024. \n\n\\\n\n## How to: do Strava map art with R \n\nThis map is a nice excuse to play with the Strava API, Open Street Maps, `R`, `ggplot`, and my favorite color tones. Here is a **step-by-step explanation** on how I coded the map. The full commented code is also available directly in this blog.\n\n\n### Step 1: Set up `R`\n\nFirst, install and load the necessary libraries. I use the `rStrava` package to connect to the Strava API and download my activities, and `osmdata` + `ggplot2` to visualize them on OpenStreetMap. Fonts are added using `showtext`.\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-summary=\"Show R code for package loading\"}\n# Strava API wrapper\nlibrary(rStrava)\n\n# OpenStreetMap and sf for polygons\nlibrary(osmdata)\nlibrary(sf)\nlibrary(googleway) # Convert polygons from Rstrava to sf\n\n# Standard tidyverse\nlibrary(readr)\nlibrary(ggplot2)\nlibrary(dplyr)\n\n# Add fonts for my graphs\nlibrary(showtext)\nfont_add_google(\"Fira Sans\", \"Fira Sans\")  \nfont_add_google(\"Bebas Neue\", \"Bebas Neue\")\nshowtext_auto()\n```\n:::\n\n\n\n\n\\ \n\n### Step 2: Get the data from Strava using the rStrava API wrapper\n\nI followed the `rStrava` vignette to authenticate with the API and access my activities. I extract my activities, keep only rides and runs, and save them as CSVs to avoid re-downloading every time. The activity data includes a compressed polyline (Google format) with GPS coordinates. I decode them into usable line geometries to visualize the actual paths of each activity. \n\nIn a second step, I use `decode_pl()` to extract the GPS coordinates from each activity‚Äôs polyline. Then I convert them to LINESTRING geometries ‚Äî after all, rides are linear paths, and Strava doesn't know random walks üò¨ü•Å.\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-summary=\"Show R code for interaction with the Strava API\"}\n# Check if I already downloaded and saved my activities. If not, connect \n# to the API and extract data. \nstrava_file <- here::here(\"posts/blog2_strava/cache/strava_run.csv\")\n\nif (!file.exists(strava_file)) {\n\n    app_name      <- Sys.getenv(\"STRAVA_APP_NAME\")\n    app_client_id <- Sys.getenv(\"STRAVA_CLIENT_ID\")\n    app_secret    <- Sys.getenv(\"STRAVA_CLIENT_SECRET\")\n\n    stopifnot(nzchar(app_client_id), nzchar(app_secret))\n\n    # create the authentication token\n    stoken <- httr::config(\n      token = strava_oauth(\n        app_name, \n        app_client_id, \n        app_secret, \n        app_scope=\"activity:read_all\")\n      )\n\n    # get activities by date range\n    my_acts <- get_activity_list(stoken, after = as.Date('2021-01-01'))\n    act_data <- compile_activities(my_acts, units = \"metric\") \n\n    # Prepare data\n    my_acts <- act_data |>\n      select(\n        id, start_date, type, name, lat = start_latlng1, lng = start_latlng2, \n        map.summary_polyline\n      ) |>\n      filter(type %in% c(\"Run\", \"Ride\")) \n\n    count(my_acts, type)\n\n    # Save data per activity\n    filter(my_acts, type == \"Run\") |>\n        write_csv(here::here(\"posts/blog2_strava/cache/strava_run.csv\"))\n    filter(my_acts, type == \"Ride\") |>\n        write_csv(here::here(\"posts/blog2_strava/cache/strava_ride.csv\"))\n\n} else {\n    my_acts <- bind_rows(\n        read_csv(here::here(\"posts/blog2_strava/cache/strava_run.csv\")),\n        read_csv(here::here(\"posts/blog2_strava/cache/strava_ride.csv\"))\n    )\n}\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-summary=\"Show R code for activity preparation\"}\n# Import polygons using a custom function\nmake_lines_sf <- function(df) {\n  \n  # Initialize new vector for results\n  res <- vector(\"list\", nrow(df))\n\n  # Control flow\n  for (j in seq_len(nrow(df))) {\n\n    coords <- tryCatch(\n      googleway::decode_pl(df$map.summary_polyline[j]),\n      error = function(e) NULL\n    )\n    if (is.null(coords)) next\n\n    coords <- coords |> \n        filter(!is.na(lat), !is.na(lon))\n    \n    if (nrow(coords) < 2) next\n\n    # Transform to lines\n    ls <- st_linestring(as.matrix(coords[, c(\"lon\", \"lat\")]))\n\n    # Store\n    res[[j]] <- st_sf(\n      id = df$id[j],\n      type = as.character(df$type[j]),\n      geometry = st_sfc(ls, crs = 4326)\n    )\n  }\n\n  out <- do.call(rbind, res[!vapply(res, is.null, logical(1))])\n  out\n}\n\nmy_acts <- my_acts |> \n  mutate(year = lubridate::year(start_date))\n\nacts_lines <- make_lines_sf(my_acts) |>\n  mutate(year = my_acts$year)\n```\n:::\n\n\n\n\\\n\n### Step 3: Create a map with all running and biking activities in 2025\n\nMy first map will be used as a post on Strava to wish my community a happy 2026. \n\nAs the basic structure of the map, I define a bounding box for Eastern Switzerland (from Z√ºrich to Bregenz, Konstanz to Luzern). That‚Äôs where most of my activities take place. I went biking and running in Western Switzerland and Spain, which I will not show on the map. I extract the main roads from OpenStreetMap using `add_osm_feature()`and cache them to a `.gpkg` file to avoid re-downloading.\n\nOnce the activities and the map have been prepared, use `ggplot()` and `geom_sf` to plot the map rectangle, the street lines, and the activities. I chose among two favorite color palettes to display the map in a nice artistic way. I also chose a font that I thought would go well with the overall design.\n\n<div style=\"text-align: center;\">\n  <img src=\"cache/map_2025.png\" style=\"width:40%;\" />\n</div>\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-summary=\"Show R code for the map and street preparation\"}\n# We create a rectangle around Eastern Switzerland\nbb_rect <- st_as_sfc(st_bbox(c(\n  xmin = 8, xmax = 9.7,\n  ymin = 46.75, ymax = 47.85\n), crs = 4326))\n\n\n# We extract the street polygons from OpenStreetMap\nroads_file <- here::here(\"posts/blog2_strava/cache/roads.gpkg\")\n\nif (!file.exists(roads_file)) {\n\n  streets <- opq(st_bbox(bb_rect)) |>\n    add_osm_feature(\n      key = \"highway\",\n      value = c(\"motorway\", \"primary\", \"secondary\", \"tertiary\")\n    ) |>\n    osmdata_sf()\n\n  streets_lines <- streets$osm_lines\n\n  dir.create(dirname(roads_file), showWarnings = FALSE, recursive = TRUE)\n\n  sf::st_write(\n    streets_lines,\n    roads_file,\n    layer = \"roads\",\n    delete_layer = TRUE,\n    quiet = TRUE\n  )\n\n} else {\n\n  streets_lines <- sf::st_read(\n    roads_file,\n    layer = \"roads\",\n    quiet = TRUE\n  )\n\n}\n\n# I don't restrict the rectangle as much for the activity maps. I like the effect it has when the activities extend to the margins.\nrect <- st_as_sfc(st_bbox(c(\n  xmin = 7.9, xmax = 9.8,\n  ymin = 46.7, ymax = 47.9\n), crs = 4326))\n\nacts_lines <- acts_lines[st_intersects(acts_lines, rect, sparse = FALSE), ]\nacts_lines_bike <- filter(acts_lines, type == \"Ride\")\nacts_lines_runbike_2025 <- filter(acts_lines, year == 2025)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-summary=\"Show R code for color palette definition\"}\n# Choose between two color palettes\nget_palette_colors <- function(palette = c(\"purple\", \"cherry\")) {\n  palette <- match.arg(palette)\n\n  if (palette == \"purple\") {\n    list(\n      background = \"#573b88\",\n      roads      = \"#9b73a9\",\n      rides      = \"#ffffff\"\n    )\n  } else {\n    list(\n      background = \"#3B0A0A\",\n      roads      = \"#663c1bff\",\n      rides      = \"#FFF8DC\"\n    )\n  }\n}\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-summary=\"Show R code for the map\"}\n# Define colors\ncolors1 <- get_palette_colors(\"cherry\")\ncolor_background <- colors1$background\ncolor_roads      <- colors1$roads\ncolor_rides      <- colors1$rides\n\n# Create the base map\nbase_map_bike <- ggplot() +\n  geom_sf(data = bb_rect, fill = color_background, color = NA) +\n  geom_sf(data = streets_lines, color = color_roads, linewidth = 0.1) +\n  coord_sf(expand = FALSE) +\n  labs(\n    title = paste0(\n      \"<span style='font-family:Fira Sans;font-size:20pt;'>After drawing so many new lines on the 2025 map,</span><br>\",\n      \"<span style='font-size:48pt;'>Happy 2026!</span>\"\n    ),\n    subtitle = \"Full of km, watts, unseen places, and joyful discoveries!\",\n    caption = \"Data: Strava ‚Ä¢ Map: OpenStreetMap ‚Ä¢ Author: Aur√©lien Sallin\"\n  ) +\n  theme_void() +\n  theme(\n    text = element_text(family = \"Bebas Neue\", color = color_rides),\n    plot.background = element_rect(fill = color_background, color = NA),\n    plot.margin = margin(t = 1, r = 10, b = 1, l = 10, unit = \"pt\"),\n    legend.position = \"none\",\n    plot.title = ggtext::element_markdown(\n      family = \"Bebas Neue\", size = 36, color = \"white\", hjust = 0.5,\n      lineheight = 0.7  \n    ),\n    plot.subtitle = ggtext::element_markdown(\n      family = \"Fira Sans\", size = 20, color = \"white\", hjust = 0.5,\n      margin = margin(t = 10)  \n    ),\n    plot.caption = element_text(\n      family = \"Fira Sans\", size = 16, color = \"white\", hjust = 0.95\n    )\n  )\n\n# Add the activity geometries\nmap_2025 <- base_map_bike +\n  geom_sf(data = acts_lines_runbike_2025, color = color_rides, linewidth = 0.5, alpha = 0.5) \n```\n:::\n\n::: {.cell}\n\n:::\n\n\n\n\\\n\n## Mapping the journey: year by year\n\n### Step 4: The final map: evolution of my rides over time\n\nI restrict the activities to biking only, and create a dataset containing the cumulated activities over the years. I use facetting to show how the map evolved year by year.\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-summary=\"Show R code for the activity preparation\"}\n# Filter on bike activities and extract the year of the activity\nmy_acts <- my_acts |> \n  filter(type == \"Ride\") |> \n  mutate(year = lubridate::year(start_date))\n\nyears <- sort(unique(my_acts$year))\n\n# Cumulate activities\ncumulative_sf_list <- list()\n\n# For each year, include all rides up to that year (cumulative map)\nfor (y in years) {\n  # Filter all rides up to and including year y\n  df_cum <- my_acts |> \n    filter(year <= y)\n\n  # Convert to sf LINESTRINGs using the function I created above\n  sf_lines <- make_lines_sf(df_cum)\n  sf_lines$year_facet <- as.character(y)  # For facetting in the graph\n\n  cumulative_sf_list[[as.character(y)]] <- sf_lines\n}\n\n# Combine into single sf object\ncumulative_rides <- do.call(rbind, cumulative_sf_list)\ncumulative_rides <- cumulative_rides[st_intersects(cumulative_rides, rect, sparse = FALSE), ]\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-summary=\"Show R code for the map\"}\nmap_peryear <- ggplot() +\n  geom_sf(data = bb_rect, fill = color_background, color = NA) +\n  geom_sf(data = streets_lines,  color = color_roads, linewidth = 0.1) +\n  coord_sf(expand = FALSE) +\n  geom_sf(data = cumulative_rides, color = color_rides, linewidth = 0.6, alpha = 0.4) +\n  facet_grid(~ year_facet) +\n  labs(\n    caption = \"\\nFive Years in the Saddle ‚Ä¢ Data: Strava ‚Ä¢ Map: OpenStreetMap ‚Ä¢ Author: Aur√©lien Sallin\"\n    ) +\n  theme_void() +\n  theme(\n    panel.background = element_rect(fill = color_background),\n    plot.background = element_rect(fill = color_background),\n    legend.position = \"none\",\n    panel.spacing = unit(0.5, \"lines\"),\n    plot.title = element_text(\n      family = \"Bebas Neue\", size = 60, color = \"white\", hjust = 0.5\n    ),\n    plot.subtitle = element_text(\n      family = \"Fira Sans\", size = 12, color = \"white\", hjust = 0.5\n    ),\n    plot.caption = element_text(\n      family = \"Fira Sans\", size = 28, color = \"white\", hjust = 0.95\n    ),\n    strip.text = element_text(\n      family = \"Bebas Neue\", size = 56, face = \"bold\", color = \"white\"\n    )\n  )\n```\n:::\n\n::: {.cell}\n\n:::\n\n\n\n\\\n\n## If it's not on Strava, it didn't happen - also in 2026\n\nFirst of all, as the saying goes, **if it's not on Strava, it didn't happen**. Now you have living proof that the metaphysical importance of Strava entries has real-life consequences. \n\n<div style=\"text-align: center;\">\n  <img src=\"cache/itdidnthappenstrava.jpg\" style=\"width:30%;\" />\n</div>\n\nSecond, making beautiful maps from Strava activities brings exactly the sense of satisfaction and achievement we seek around the new year. With the cold outside, spending extra time coding was quite rewarding. **Take care and happy 2026!**\n\n<div style=\"text-align: center;\">\n  <img src=\"cache/biking.jpg\" style=\"width:40%;\" />\n</div>\n\n\n\n\\\n\n## References\n\nThanks for inspiration from [Sarah Van Alsten](https://sarahvanalsten.netlify.app/post/strava/mapping-your-rides-with-rstrava/), [Sam Shanny-Csik](https://github.com/samanthacsik/strava-hikes), and [Bernhard Bieri](https://bernhardbieri.ch/blog/2023-01-28-mapmaking-with-r-and-openstreetmaps/) for the very nice-looking maps using Open Street Maps.",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}